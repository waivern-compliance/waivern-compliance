name: "GitHub Source Code Analysis"
description: >
  Analyse source code fetched from a GitHub repository for personal data handling
  and processing purposes. This runbook demonstrates how to use GitHubConnector
  to clone a repository and analyse its source code for GDPR compliance.
contact: "Security Team <security@company.co.uk>"

artifacts:
  # Source artifact - extract code from GitHub repository
  github_source_code:
    name: "GitHub Repository Source Code"
    description: "Clone repository and extract PHP source files for analysis"
    source:
      type: "github"
      properties:
        repository: "waivern-compliance/waivern-compliance"
        clone_strategy: "minimal"
        # Only include the mock PHP files used for testing
        include_patterns:
          - "libs/waivern-filesystem/tests/waivern_filesystem/filesystem_mock_lite/source_code/*.php"
          - "libs/waivern-filesystem/tests/waivern_filesystem/filesystem_mock/source_code/*.php"
        max_files: 50

  # Personal data analysis
  source_personal_data_indicators:
    name: "Personal Data Detection in Source Code"
    description: "Scan source code for personal data handling patterns and PII references"
    contact: "Development Team <dev@company.co.uk>"
    inputs: github_source_code
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "local/personal_data_indicator/1.0.0"
          evidence_context_size: "large"
          maximum_evidence_count: 5
        llm_validation:
          enable_llm_validation: false

  source_gdpr_personal_data:
    name: "GDPR Personal Data Classification (Source Code)"
    description: "Classify detected personal data indicators according to GDPR categories"
    inputs: source_personal_data_indicators
    process:
      type: "gdpr_personal_data_classifier"
    output: true

  source_processing_purpose:
    name: "Processing Purpose Analysis in Source Code"
    description: "Identify data processing purposes from code comments, variable names, and function signatures"
    inputs: github_source_code
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 5
        llm_validation:
          enable_llm_validation: false
    output: true

  # Source code pipeline: GitHub → SourceCodeAnalyser → DataSubject
  # This demonstrates the source_code schema path for data subject detection
  parsed_source_code:
    name: "Parsed PHP Source Code"
    description: "Parse PHP source files to extract code structure for analysis"
    inputs: github_source_code
    process:
      type: "source_code_analyser"
      properties:
        language: "php"
        max_file_size: 10485760  # 10MB

  source_data_subject_indicators:
    name: "Data Subject Detection in Source Code"
    description: "Detect data subject categories from PHP source code using source code-aware pattern matching"
    contact: "Security Team <security@company.co.uk>"
    inputs: parsed_source_code
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 5
        source_code_context_window: "small"
        llm_validation:
          enable_llm_validation: false

  source_gdpr_data_subject:
    name: "GDPR Data Subject Classification (Source Code)"
    description: "Classify detected data subject indicators according to GDPR categories for Article 30(1)(c) compliance"
    inputs: source_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true
