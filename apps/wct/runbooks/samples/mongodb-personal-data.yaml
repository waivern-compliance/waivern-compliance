name: "Sample Runbook for MongoDB Personal Data Analysis"
description: >
  Analyse MongoDB database for personal data.
  This runbook extracts data from MongoDB collections and runs personal data analysis.


  Prerequisites:
    1. Start MongoDB: docker run -d --name mongodb -p 27017:27017 mongo:latest
    2. Set env vars in apps/wct/.env: MONGODB_URI, MONGODB_DATABASE
    3. Seed database: uv run python -m waivern_mongodb.scripts.seed_healthcare
    4. Run: uv run wct run apps/wct/runbooks/samples/mongodb-personal-data.yaml
contact: "Data Protection Team <dpo@company.co.uk>"

artifacts:
  # Source artifact - extract data from MongoDB
  mongodb_data:
    name: "MongoDB Database Content"
    description: "Extract data from MongoDB database collections"
    source:
      type: "mongodb"
      properties:
        # MongoDB credentials are first tried from environment variables:
        # MONGODB_URI, MONGODB_DATABASE
        # You can also specify them here, but environment variables
        # take precedence and are recommended for security reasons
        sample_size: 10

  # Personal data analysis on MongoDB content
  mongodb_personal_data:
    name: "Personal Data Detection in MongoDB"
    description: "Scan MongoDB collections for personally identifiable information using pattern matching"
    contact: "Data Protection Team <dpo@company.co.uk>"
    inputs: mongodb_data
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "personal_data"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 80
          llm_validation_mode: "conservative"
    output: true

  # Data subject classification on MongoDB content
  mongodb_data_subject:
    name: "Data Subject Classification in MongoDB"
    description: "Identify data subject categories (employees, customers, etc.) from MongoDB content for GDPR Article 30(1)(c) compliance"
    contact: "Data Protection Team <dpo@company.co.uk>"
    inputs: mongodb_data
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "data_subjects"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"
    output: true
