name: "Sample Runbook for MongoDB Personal Data Analysis"
description: >
  Analyse MongoDB database for personal data.
  This runbook extracts data from MongoDB collections and runs personal data analysis.


  Prerequisites:
    1. Start MongoDB: docker run -d --name mongodb -p 27017:27017 mongo:latest
    2. Set env vars in apps/wct/.env: MONGODB_URI, MONGODB_DATABASE
    3. Seed database: uv run python -m waivern_mongodb.scripts.seed_healthcare
    4. Run: uv run wct run apps/wct/runbooks/samples/mongodb-personal-data.yaml
contact: "Data Protection Team <dpo@company.co.uk>"
artifacts:
  # Source artifact - extract data from MongoDB
  mongodb_data:
    name: "MongoDB Database Content"
    description: "Extract data from MongoDB database collections"
    source:
      type: "mongodb"
      properties:
        # MongoDB credentials are first tried from environment variables:
        # MONGODB_URI, MONGODB_DATABASE
        # You can also specify them here, but environment variables
        # take precedence and are recommended for security reasons
        sample_size: 10

  # Personal data analysis pipeline
  mongodb_personal_data_indicators:
    name: "Personal Data Detection in MongoDB"
    description: "Scan MongoDB collections for personally identifiable information"
    contact: "Data Protection Team <dpo@company.co.uk>"
    inputs: mongodb_data
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "local/personal_data_indicator/1.0.0"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 80
          llm_validation_mode: "conservative"

  mongodb_gdpr_personal_data:
    name: "GDPR Personal Data Classification (MongoDB)"
    description: "Classify detected personal data indicators according to GDPR categories"
    inputs: mongodb_personal_data_indicators
    process:
      type: "gdpr_personal_data_classifier"
    output: true

  # Data subject classification on MongoDB content
  mongodb_data_subject_indicators:
    name: "Data Subject Detection in MongoDB"
    description: "Detect data subject categories (employees, customers, etc.) from MongoDB content using pattern matching"
    contact: "Data Protection Team <dpo@company.co.uk>"
    inputs: mongodb_data
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  mongodb_gdpr_data_subject:
    name: "GDPR Data Subject Classification (MongoDB)"
    description: "Classify detected data subject indicators according to GDPR categories for Article 30(1)(c) compliance"
    inputs: mongodb_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true
