name: "Lightweight LAMP Stack Analysis with SQLite"
description: >
  Analyse SQLite database and filesystem for personally sensitive information and processing purposes.
  This runbook provides comprehensive analysis using SQLite instead of MySQL and a lightweight
  filesystem mock for easier testing and development workflows.
contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"

artifacts:
  # Source artifacts - data extraction from various sources
  sqlite_data:
    name: "SQLite Database Content"
    description: "Extract data from SQLite compliance test database"
    source:
      type: "sqlite"
      properties:
        database_path: "./apps/wct/tests/integration/test_data/sqlite_compliance_test.db"
        max_rows_per_table: 10

  filesystem_data:
    name: "Filesystem Content"
    description: "Read files from filesystem mock"
    source:
      type: "filesystem"
      properties:
        path: "./libs/waivern-filesystem/tests/waivern_filesystem/filesystem_mock_lite"
        exclude_patterns: ["README_lite.md"]
        max_files: 50
        encoding: "utf-8"

  # SQLite analysis artifacts
  sqlite_personal_data_indicators:
    name: "Personal Data Detection in SQLite Database"
    description: "Scan SQLite database tables and columns for personally identifiable information"
    contact: "Emily Chen (Database Administrator) <emily.chen@company.co.uk>"
    inputs: sqlite_data
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "local/personal_data_indicator/1.0.0"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 80
          llm_validation_mode: "conservative"

  sqlite_gdpr_personal_data:
    name: "GDPR Personal Data Classification (SQLite)"
    description: "Classify detected personal data indicators according to GDPR categories"
    inputs: sqlite_personal_data_indicators
    process:
      type: "gdpr_personal_data_classifier"
    output: true

  sqlite_data_subject_indicators:
    name: "Data Subject Detection in SQLite Database"
    description: "Detect data subject categories from database content using pattern matching"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: sqlite_data
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  sqlite_gdpr_data_subject:
    name: "GDPR Data Subject Classification (SQLite)"
    description: "Classify detected data subject indicators according to GDPR categories for Article 30(1)(c) compliance"
    inputs: sqlite_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true

  sqlite_processing_purpose_indicators:
    name: "Processing Purpose Detection in SQLite Database"
    description: "Detect processing purposes from database content using pattern matching"
    inputs: sqlite_data
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 20
          llm_validation_mode: "conservative"
          confidence_threshold: 0.5

  sqlite_gdpr_processing_purpose:
    name: "GDPR Processing Purpose Classification (SQLite)"
    description: "Classify detected processing purposes according to GDPR categories, sensitivity, and DPIA requirements"
    inputs: sqlite_processing_purpose_indicators
    process:
      type: "gdpr_processing_purpose_classifier"
    output: true

  # Filesystem analysis artifacts
  filesystem_personal_data_indicators:
    name: "Personal Data Detection in Filesystem"
    description: "Scan filesystem mock for personally identifiable information in files"
    contact: "Michael Brown (DevOps) <michael.brown@company.co.uk>"
    inputs: filesystem_data
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "local/personal_data_indicator/1.0.0"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  filesystem_gdpr_personal_data:
    name: "GDPR Personal Data Classification (Filesystem)"
    description: "Classify detected personal data indicators according to GDPR categories"
    inputs: filesystem_personal_data_indicators
    process:
      type: "gdpr_personal_data_classifier"
    output: true

  filesystem_processing_purpose_indicators:
    name: "Processing Purpose Detection in Filesystem"
    description: "Detect processing purposes from filesystem content using pattern matching"
    inputs: filesystem_data
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 30
          llm_validation_mode: "conservative"
          confidence_threshold: 0.5

  filesystem_gdpr_processing_purpose:
    name: "GDPR Processing Purpose Classification (Filesystem)"
    description: "Classify detected processing purposes according to GDPR categories, sensitivity, and DPIA requirements"
    inputs: filesystem_processing_purpose_indicators
    process:
      type: "gdpr_processing_purpose_classifier"
    output: true

  # PHP source code pipeline: Filesystem → SourceCode → DataSubject
  php_files:
    name: "PHP Source Files"
    description: "Read PHP application files from filesystem"
    source:
      type: "filesystem"
      properties:
        path: "./libs/waivern-filesystem/tests/waivern_filesystem/filesystem_mock_lite/source_code"
        include_patterns: ["*.php"]
        max_files: 50
        encoding: "utf-8"

  php_source_code:
    name: "Parsed PHP Source Code"
    description: "Parse PHP source files to extract code structure for analysis"
    inputs: php_files
    process:
      type: "source_code_analyser"
      properties:
        language: "php"
        max_file_size: 10485760  # 10MB

  php_data_subject_indicators:
    name: "Data Subject Detection in PHP Source Code"
    description: "Detect data subject categories from PHP application code using source code-aware pattern matching"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: php_source_code
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        source_code_context_window: "small"
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  php_gdpr_data_subject:
    name: "GDPR Data Subject Classification (PHP Source Code)"
    description: "Classify detected data subject indicators from PHP code according to GDPR categories for Article 30(1)(c) compliance"
    inputs: php_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true

  php_processing_purpose_indicators:
    name: "PHP Source Code Processing Purpose Detection"
    description: "Analyse PHP application code for business logic and data processing activities"
    inputs: php_source_code
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50

  php_gdpr_processing_purpose:
    name: "GDPR Processing Purpose Classification (PHP Source Code)"
    description: "Classify detected processing purposes from PHP code according to GDPR categories, sensitivity, and DPIA requirements"
    inputs: php_processing_purpose_indicators
    process:
      type: "gdpr_processing_purpose_classifier"
    output: true
