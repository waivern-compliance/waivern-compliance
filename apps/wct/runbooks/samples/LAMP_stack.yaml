name: "Sample Runbook for GDPR Analysis of a LAMP Stack"
description: >
  Analyse database and source code for GDPR.
  This runbook runs both personal data analysis and processing purpose analysis on MySQL and PHP source code.
  Demonstrates pipeline execution: Filesystem → SourceCodeAnalyser → ProcessingPurposeAnalyser.
contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"

artifacts:
  # Source artifacts - data extraction from various sources
  php_files:
    name: "PHP Source Files"
    description: "Read PHP application files from filesystem"
    source:
      type: "filesystem"
      properties:
        path: "./libs/waivern-processing-purpose-analyser/tests/waivern_processing_purpose_analyser/source_code_mock_php"
        include_patterns: ["*.php"]
        max_files: 100
        encoding: "utf-8"

  log_files:
    name: "Log Files"
    description: "Read log files from filesystem"
    source:
      type: "filesystem"
      properties:
        path: "./libs/waivern-filesystem/tests/waivern_filesystem/filesystem_mock/logs"
        exclude_patterns: []
        max_files: 100
        encoding: "utf-8"

  mysql_data:
    name: "MySQL Database Content"
    description: "Extract data from MySQL database"
    source:
      type: "mysql"
      properties:
        # MySQL credentials are first tried from environment variables:
        # MYSQL_HOST, MYSQL_USER, MYSQL_PASSWORD, MYSQL_DATABASE, MYSQL_PORT
        # You can also specify them here, but environment variables
        # take precedence and are recommended for security reasons
        max_rows_per_table: 10

  # Log file analysis artifacts
  logs_data_subject:
    name: "Data Subject Classification in Log Files"
    description: "Identify data subject categories (employees, customers, etc.) from log file content for GDPR Article 30(1)(c) compliance"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: log_files
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "data_subjects"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"
    output: true

  logs_personal_data:
    name: "Personal Data Detection in Log Files"
    description: "Scan log files for personally identifiable information using pattern matching and context analysis"
    contact: "Michael Brown (DevOps) <michael.brown@company.co.uk>"
    inputs: log_files
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "personal_data"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"
    output: true

  logs_processing_purpose:
    name: "Processing Purpose Analysis of Log Content"
    description: "Identify data processing purposes and compliance frameworks from log file content and system activities"
    inputs: log_files
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "processing_purposes"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 30
          llm_validation_mode: "conservative"
          confidence_threshold: 0.5
    output: true

  # MySQL analysis artifacts
  mysql_processing_purpose:
    name: "Processing Purpose Analysis of Database Content"
    description: "Identify GDPR and CCPA compliance processing purposes from database structure and content"
    inputs: mysql_data
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "processing_purposes"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 20
          llm_validation_mode: "conservative"
          confidence_threshold: 0.5
    output: true

  mysql_personal_data:
    name: "Personal Data Detection in MySQL Database"
    description: "Scan MySQL database tables and columns for personally identifiable information using pattern matching"
    contact: "Emily Chen (Database Administrator) <emily.chen@company.co.uk>"
    inputs: mysql_data
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "personal_data"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 80
          llm_validation_mode: "conservative"
    output: true

  mysql_data_subject:
    name: "Data Subject Classification in MySQL Database"
    description: "Identify data subject categories (employees, customers, etc.) from database content for GDPR Article 30(1)(c) compliance"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: mysql_data
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "data_subjects"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"
    output: true

  # PHP source code pipeline: Filesystem → SourceCode → ProcessingPurpose
  php_source_code:
    name: "Read PHP Source Files"
    description: "Read PHP application files from filesystem and parse source code structure"
    contact: "James Wilson (Lead Developer) <james.wilson@company.co.uk>"
    inputs: php_files
    process:
      type: "source_code_analyser"
      properties:
        language: "php"
        max_file_size: 10485760  # 10MB
    output: true

  php_processing_purpose:
    name: "PHP Source Code Processing Purpose Detection"
    description: "Analyse PHP application code for business logic, service integrations, and data processing activities"
    contact: "James Wilson (Lead Developer) <james.wilson@company.co.uk>"
    inputs: php_source_code
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "processing_purposes"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
    output: true
