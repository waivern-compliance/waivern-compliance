name: "Sample Runbook for GDPR Analysis of a LAMP Stack"
description: >
  Analyse database and source code for GDPR.
  This runbook runs both personal data analysis and processing purpose analysis on MySQL and PHP source code.
  Demonstrates pipeline execution: Filesystem → SourceCodeAnalyser → ProcessingPurposeAnalyser.
contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"

artifacts:
  # Source artifacts - data extraction from various sources
  php_files:
    name: "PHP Source Files"
    description: "Read PHP application files from filesystem"
    source:
      type: "filesystem"
      properties:
        path: "./libs/waivern-processing-purpose-analyser/tests/waivern_processing_purpose_analyser/source_code_mock_php"
        include_patterns: ["*.php"]
        max_files: 100
        encoding: "utf-8"

  log_files:
    name: "Log Files"
    description: "Read log files from filesystem"
    source:
      type: "filesystem"
      properties:
        path: "./libs/waivern-filesystem/tests/waivern_filesystem/filesystem_mock/logs"
        exclude_patterns: []
        max_files: 100
        encoding: "utf-8"

  mysql_data:
    name: "MySQL Database Content"
    description: "Extract data from MySQL database"
    source:
      type: "mysql"
      properties:
        # MySQL credentials are first tried from environment variables:
        # MYSQL_HOST, MYSQL_USER, MYSQL_PASSWORD, MYSQL_DATABASE, MYSQL_PORT
        # You can also specify them here, but environment variables
        # take precedence and are recommended for security reasons
        max_rows_per_table: 10

  # Log file analysis artifacts
  logs_data_subject_indicators:
    name: "Data Subject Detection in Log Files"
    description: "Detect data subject categories (employees, customers, etc.) from log file content using pattern matching"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: log_files
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  logs_gdpr_data_subject:
    name: "GDPR Data Subject Classification (Logs)"
    description: "Classify detected data subject indicators according to GDPR categories for Article 30(1)(c) compliance"
    inputs: logs_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true

  logs_personal_data_indicators:
    name: "Personal Data Detection in Log Files"
    description: "Scan log files for personally identifiable information using pattern matching and context analysis"
    contact: "Michael Brown (DevOps) <michael.brown@company.co.uk>"
    inputs: log_files
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "local/personal_data_indicator/1.0.0"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  logs_gdpr_personal_data:
    name: "GDPR Personal Data Classification (Logs)"
    description: "Classify detected personal data indicators according to GDPR categories"
    inputs: logs_personal_data_indicators
    process:
      type: "gdpr_personal_data_classifier"
    output: true

  logs_processing_purpose_indicators:
    name: "Processing Purpose Detection in Log Files"
    description: "Detect processing purposes from log file content using pattern matching"
    inputs: log_files
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 30
          llm_validation_mode: "conservative"
          confidence_threshold: 0.5

  logs_gdpr_processing_purpose:
    name: "GDPR Processing Purpose Classification (Logs)"
    description: "Classify detected processing purposes according to GDPR categories, sensitivity, and DPIA requirements"
    inputs: logs_processing_purpose_indicators
    process:
      type: "gdpr_processing_purpose_classifier"
    output: true

  # MySQL analysis artifacts
  mysql_processing_purpose_indicators:
    name: "Processing Purpose Detection in MySQL Database"
    description: "Detect processing purposes from database structure and content using pattern matching"
    inputs: mysql_data
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 20
          llm_validation_mode: "conservative"
          confidence_threshold: 0.5

  mysql_gdpr_processing_purpose:
    name: "GDPR Processing Purpose Classification (MySQL)"
    description: "Classify detected processing purposes according to GDPR categories, sensitivity, and DPIA requirements"
    inputs: mysql_processing_purpose_indicators
    process:
      type: "gdpr_processing_purpose_classifier"
    output: true

  mysql_personal_data_indicators:
    name: "Personal Data Detection in MySQL Database"
    description: "Scan MySQL database tables and columns for personally identifiable information using pattern matching"
    contact: "Emily Chen (Database Administrator) <emily.chen@company.co.uk>"
    inputs: mysql_data
    process:
      type: "personal_data"
      properties:
        pattern_matching:
          ruleset: "local/personal_data_indicator/1.0.0"
          evidence_context_size: "large"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 80
          llm_validation_mode: "conservative"

  mysql_gdpr_personal_data:
    name: "GDPR Personal Data Classification (MySQL)"
    description: "Classify detected personal data indicators according to GDPR categories"
    inputs: mysql_personal_data_indicators
    process:
      type: "gdpr_personal_data_classifier"
    output: true

  mysql_data_subject_indicators:
    name: "Data Subject Detection in MySQL Database"
    description: "Detect data subject categories (employees, customers, etc.) from database content using pattern matching"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: mysql_data
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  mysql_gdpr_data_subject:
    name: "GDPR Data Subject Classification (MySQL)"
    description: "Classify detected data subject indicators according to GDPR categories for Article 30(1)(c) compliance"
    inputs: mysql_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true

  # PHP source code pipeline: Filesystem → SourceCode → ProcessingPurpose
  php_source_code:
    name: "Read PHP Source Files"
    description: "Read PHP application files from filesystem and parse source code structure"
    contact: "James Wilson (Lead Developer) <james.wilson@company.co.uk>"
    inputs: php_files
    process:
      type: "source_code_analyser"
      properties:
        language: "php"
        max_file_size: 10485760  # 10MB
    output: true

  php_processing_purpose_indicators:
    name: "PHP Source Code Processing Purpose Detection"
    description: "Analyse PHP application code for business logic, service integrations, and data processing activities"
    contact: "James Wilson (Lead Developer) <james.wilson@company.co.uk>"
    inputs: php_source_code
    process:
      type: "processing_purpose"
      properties:
        pattern_matching:
          ruleset: "local/processing_purposes/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50

  php_gdpr_processing_purpose:
    name: "GDPR Processing Purpose Classification (PHP Source Code)"
    description: "Classify detected processing purposes from PHP code according to GDPR categories, sensitivity, and DPIA requirements"
    inputs: php_processing_purpose_indicators
    process:
      type: "gdpr_processing_purpose_classifier"
    output: true

  php_data_subject_indicators:
    name: "Data Subject Detection in PHP Source Code"
    description: "Detect data subject categories (employees, customers, etc.) from PHP application code using source code-aware pattern matching"
    contact: "Sarah Johnson (DPO) <sarah.johnson@company.co.uk>"
    inputs: php_source_code
    process:
      type: "data_subject"
      properties:
        pattern_matching:
          ruleset: "local/data_subject_indicator/1.0.0"
          evidence_context_size: "medium"
          maximum_evidence_count: 3
        source_code_context_window: "small"
        llm_validation:
          enable_llm_validation: false
          llm_batch_size: 50
          llm_validation_mode: "conservative"

  php_gdpr_data_subject:
    name: "GDPR Data Subject Classification (PHP Source Code)"
    description: "Classify detected data subject indicators from PHP code according to GDPR categories for Article 30(1)(c) compliance"
    inputs: php_data_subject_indicators
    process:
      type: "gdpr_data_subject_classifier"
    output: true
