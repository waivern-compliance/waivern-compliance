{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "schemaVersion": {
      "type": "string"
    },
    "name": {
      "type": "string"
    },
    "description": {
      "type": "string"
    },
    "language": {
      "type": "string",
      "description": "Programming language detected (php, javascript, python, etc.)"
    },
    "source": {
      "type": "string",
      "description": "Source path or identifier"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "total_files": {
          "type": "integer"
        },
        "total_lines": {
          "type": "integer"
        },
        "analysis_timestamp": {
          "type": "string",
          "format": "date-time"
        }
      },
      "additionalProperties": true
    },
    "data": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "file_path": {
            "type": "string",
            "description": "Relative path to the source file"
          },
          "language": {
            "type": "string",
            "description": "Detected programming language for this file"
          },
          "syntax_tree": {
            "type": "object",
            "description": "Simplified AST representation",
            "additionalProperties": true
          },
          "functions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "line_start": {
                  "type": "integer"
                },
                "line_end": {
                  "type": "integer"
                },
                "parameters": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "type": {
                        "type": ["string", "null"]
                      },
                      "default_value": {
                        "type": ["string", "null"]
                      }
                    },
                    "required": ["name"]
                  }
                },
                "return_type": {
                  "type": ["string", "null"]
                },
                "visibility": {
                  "type": ["string", "null"],
                  "enum": ["public", "private", "protected", null]
                },
                "is_static": {
                  "type": "boolean"
                },
                "docstring": {
                  "type": ["string", "null"]
                }
              },
              "required": ["name", "line_start", "line_end"]
            }
          },
          "classes": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "line_start": {
                  "type": "integer"
                },
                "line_end": {
                  "type": "integer"
                },
                "extends": {
                  "type": ["string", "null"]
                },
                "implements": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "properties": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "type": {
                        "type": ["string", "null"]
                      },
                      "visibility": {
                        "type": "string",
                        "enum": ["public", "private", "protected"]
                      },
                      "is_static": {
                        "type": "boolean"
                      },
                      "default_value": {
                        "type": ["string", "null"]
                      }
                    },
                    "required": ["name"]
                  }
                },
                "methods": {
                  "type": "array",
                  "items": {
                    "$ref": "#/properties/data/items/properties/functions/items"
                  }
                }
              },
              "required": ["name", "line_start", "line_end"]
            }
          },
          "imports": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "module": {
                  "type": "string"
                },
                "alias": {
                  "type": ["string", "null"]
                },
                "line": {
                  "type": "integer"
                },
                "type": {
                  "type": "string",
                  "enum": ["require", "require_once", "include", "include_once", "use", "import"]
                }
              },
              "required": ["module", "line", "type"]
            }
          },
          "raw_content": {
            "type": "string",
            "description": "Full source code content for pattern analysis in analysers"
          },
          "metadata": {
            "type": "object",
            "properties": {
              "file_size": {
                "type": "integer"
              },
              "line_count": {
                "type": "integer"
              },
              "last_modified": {
                "type": "string",
                "format": "date-time"
              }
            },
            "additionalProperties": true
          }
        },
        "required": ["file_path", "language", "raw_content", "metadata"]
      }
    }
  },
  "required": ["schemaVersion", "name", "language", "data"]
}
