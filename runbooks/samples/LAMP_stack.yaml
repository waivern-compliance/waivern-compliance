name: "Sample Runbook for LAMP Stack"
description: >
  Analyse database and source code for potentially sensitive information and processing purposes.
  This runbook runs both personal data analysis and processing purpose analysis on MySQL and PHP source code.

connectors:
  - name: my_mysql_db
    type: mysql
    properties:
      # MySQL credentials are first tried from environment variables:
      # MYSQL_HOST, MYSQL_USER, MYSQL_PASSWORD, MYSQL_DATABASE, MYSQL_PORT
      # You can also specify them here, but environment variables
      # take precedence and are recommended for security reasons
      max_rows_per_table: 5
  - name: "php_source_code"
    type: "source_code"
    properties:
      path: "./tests/wct/analysers/processing_purpose_analyser/source_code_mock_php"
      language: "php"
      file_patterns: ["**/*.php"]
      max_file_size: 10485760  # 10MB
      max_files: 30  # Allow up to 30 files (we have 25)
      analysis_depth: "detailed"

analysers:
  - name: "personal_data_analyser_for_mysql"
    type: "personal_data_analyser"
    properties:
      # Pattern matching configuration
      pattern_matching:
        ruleset: "personal_data"
        evidence_context_size: "long"
        maximum_evidence_count: 3

      # LLM validation configuration
      llm_validation:
        enable_llm_validation: false
        llm_batch_size: 80
        llm_validation_mode: "conservative"  # More careful validation for database content
  - name: "processing_purpose_analyser_for_source_code"
    type: "processing_purpose_analyser"
    properties:
      # Pattern matching configuration
      pattern_matching:
        ruleset: "processing_purposes"
        evidence_context_size: "medium"
        maximum_evidence_count: 3

      # LLM validation configuration
      llm_validation:
        enable_llm_validation: false
        llm_batch_size: 50
    metadata:
      priority: "high"
      description: "Analyse PHP source code for processing purposes and service integrations"
  - name: "processing_purpose_analyser_for_mysql"
    type: "processing_purpose_analyser"
    properties:
      # Pattern matching configuration
      pattern_matching:
        ruleset: "processing_purposes"
        evidence_context_size: "medium"
        maximum_evidence_count: 3

      # LLM validation configuration
      llm_validation:
        enable_llm_validation: false
        llm_batch_size: 20
        llm_validation_mode: "conservative"
        confidence_threshold: 0.5
    metadata:
      priority: "medium"
      description: "Identify data processing purposes from MySQL database content"
      compliance_frameworks: ["GDPR", "CCPA"]

execution:
  - connector: "my_mysql_db"
    analyser: "personal_data_analyser_for_mysql"
    input_schema: "standard_input"
    output_schema: "personal_data_finding"
    context:
      description: "Analyse MySQL database for personal data collection"
      priority: "high"
  - connector: "my_mysql_db"
    analyser: "processing_purpose_analyser_for_mysql"
    input_schema: "standard_input"
    output_schema: "processing_purpose_finding"
    context:
      description: "Identify data processing purposes from MySQL database content"
      priority: "medium"
      compliance_frameworks: ["GDPR", "CCPA"]
      analysis_type: "database_content_analysis"
  - connector: "php_source_code"
    analyser: "processing_purpose_analyser_for_source_code"
    input_schema: "source_code"
    output_schema: "processing_purpose_finding"
    context:
      description: "Analyse PHP source code for processing purposes and service integrations"
      priority: "high"
      analysis_focus:
        - "processing_purpose_detection"
        - "service_integration_detection"
        - "business_logic_analysis"
